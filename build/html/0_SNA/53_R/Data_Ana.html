

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>&lt;no title&gt; &mdash; EveryThing 2.0.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="EveryThing 2.0.0 documentation" href="../../index.html"/>
        <link rel="up" title="R" href="../53_R.html"/>
        <link rel="next" title="R" href="../../Snippet/R.html"/>
        <link rel="prev" title="R" href="../53_R.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> EveryThing
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption" role="heading"><span class="caption-text">SNA</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../10_sphinx_rst.html">Sphinx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../30_gee.html">GEE</a></li>
<li class="toctree-l1"><a class="reference internal" href="../50_plots.html">Scientific Plots</a></li>
<li class="toctree-l1"><a class="reference internal" href="../51_pandas.html">Pandas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../52_matplotlib.html">Matplotlib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../53_R.html">R</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Snippet/R.html">R</a></li>
<li class="toctree-l1"><a class="reference internal" href="../31_Arcgis%26Frag.html">Arcgis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Snippet/python.html">Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../54_Javascript.html">Javascript</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Discussion</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../2_DIS/11_debate.html">辩行记</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../2_DIS/12_toc.html">TOC</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">EveryThing</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../53_R.html">R</a> &raquo;</li>
        
      <li>&lt;no title&gt;</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/0_SNA/53_R/Data_Ana.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <p># R语言_数据处理</p>
<p>运用R语言进行数据处理。</p>
<p>数据导入、数据结构、数据格式、数值处理、表格处理、日期处理、数字处理、缺失值与唯一值；
## 数据导入与导出</p>
<p>### 导入
* 要导入的数据必须存放在getwd()目录下
* Windows下路径要用斜杠/或者双反斜杠`\`</p>
<p><a href="#id1"><span class="problematic" id="id2">``</span></a><a href="#id3"><span class="problematic" id="id4">`</span></a>R
library(readr)</p>
<p>read_csv(“filename.csv”, col_names=c(), col_types=col( colname=col_  ))
## read_csv导入 读取分隔符为逗号
library(readr)
data &lt;- read_csv(“filename.csv”, col_names =c(“”,””), col_types=col( cost=col_numeric(),  ))
library(dplyr)
data &lt;- tbl_df(data) # 将表格转化为tbl_df的格式
View(data)  # 视图形式查看</p>
<p># 设置列名 col_names = TRUE/FASLE/c(“name1”,”name2”)  # 第一行作为列名/不作为列名/重命名[数量必须相同]
# 排除某个列、变更列的格式 col_types = cols( X6=col_skip(),X1=col_character() ) # 不选中X6列 （X6为列名）
# 设置编码 locale = locale(encoding = “UTF-8”)</p>
<p>## read.table导入
data &lt;- read.table(“filename.csv”, header=TRUE,sep=””,na.strings=c(“x”))
# header=T,即将第一行作为列名；默认为FASLE;
# sep=””，分隔符；默认为（空格、换行、回车、制表符），可设置为逗号(,)、制表符(t)
# na.strings=c(“x”,”y”)  将等号之后的内容会被转换成NA；即该表中x/y的值会被转化为NA</p>
<p>## 直接用RStudio导入
分别设置第一行为列名、更改列名、列格式、跳过列
<a href="#id5"><span class="problematic" id="id6">``</span></a><a href="#id7"><span class="problematic" id="id8">`</span></a></p>
<p><code class="docutils literal notranslate"><span class="pre">`R</span>
<span class="pre">##</span> <span class="pre">加载包中的数据</span>
<span class="pre">data(filename,</span> <span class="pre">package=&quot;&quot;)</span>&#160; <span class="pre">#</span> <span class="pre">装在包中的特定数据</span>
<span class="pre">##</span> <span class="pre">列出当前已加载包中所含的所有可用示例数据集</span>
<span class="pre">data()</span> <span class="pre">/</span> <span class="pre">data(package=&quot;&quot;)</span>
<span class="pre">`</span></code></p>
<p>### 导出
<code class="docutils literal notranslate"><span class="pre">`R</span>
<span class="pre">setwd(&quot;D:\\&quot;)</span>
<span class="pre">write.table(y,&quot;sample.csv&quot;,sep=&quot;,&quot;)</span>
<span class="pre">#</span> <span class="pre">y是R中的数据，sample.csv是存到本地的文件名</span>
<span class="pre">write.csv(data,</span> <span class="pre">file=&quot;D:/bearf2.csv&quot;)</span>&#160; <span class="pre">#</span> <span class="pre">若保存至其他位置，需要完整路径</span>
<span class="pre">`</span></code></p>
<p>## 数据结构
### 数据整体结构
<code class="docutils literal notranslate"><span class="pre">`R</span>
<span class="pre">##</span> <span class="pre">返回数据结构</span>
<span class="pre">str(object)</span>
<span class="pre">##</span> <span class="pre">返回数据结构/统计摘要</span>
<span class="pre">summary()</span>
<span class="pre">#</span> <span class="pre">区别对待不同类型的数据变量-</span> <span class="pre">(1)数值型：相关极值等信息；(2)名义型/有序型：显示的是各水平的频数值</span>
<span class="pre">##</span> <span class="pre">返回对象格式/类型</span>
<span class="pre">class()</span>&#160; <span class="pre">#</span> <span class="pre">返回</span> <span class="pre">numeric</span> <span class="pre">/</span> <span class="pre">character</span> <span class="pre">/</span> <span class="pre">factor</span> <span class="pre">/</span> <span class="pre">ts</span> <span class="pre">…</span>
<span class="pre">##</span> <span class="pre">返回对象维度</span>
<span class="pre">dim()</span>
<span class="pre">##</span> <span class="pre">返回对象模式</span>
<span class="pre">mode()</span>
<span class="pre">`</span></code>
### 行列名称&amp;重命名</p>
<p><a href="#id9"><span class="problematic" id="id10">``</span></a><a href="#id11"><span class="problematic" id="id12">`</span></a>R
## 返回所有列的名称
names(object)
colnames(object)</p>
<p>## 返回所有行的名称
row.names(object)
rownames(object) –二维以上的任何对象
<a href="#id13"><span class="problematic" id="id14">``</span></a>`
<a href="#id15"><span class="problematic" id="id16">``</span></a><a href="#id17"><span class="problematic" id="id18">`</span></a>R
## 直接修改
fix(object)  # 可以改变格式 numeric / character</p>
<p>## 重命名列名
library(dplyr)
rename(data, newname=oldname)  # 新的列名在前</p>
<p>## 选择变量时进行重命名
select(data, oldname = newname)  # 新的列名在后
<code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">###</span> <span class="pre">列重新排序</span>
<span class="pre">```R</span>
<span class="pre">mtcars</span> <span class="pre">&lt;-</span> <span class="pre">mtacrs[,</span> <span class="pre">c(12,1:11)]</span>&#160; <span class="pre">#</span> <span class="pre">将第12列置于第一行</span>
<span class="pre">`</span></code>
### 长宽格式转换
<a href="#id19"><span class="problematic" id="id20">``</span></a><cite>R
## 转为长格式形式
library(reshape2)
melt(data, id.vars, measure.vars,variable.name = “variable”, …, na.rm = FALSE, value.name = “value”,  factorsAsStrings = TRUE)
# varaiable.name ，表示将 各个变量的列名 放在这个列下面；
# value.name，表示对应观测值的具体数值
new &lt;- melt(data, id=”var”, measure=”var”)
# id=”var”/ c(“var1”,”var2”)  以该变量为基准进行重构
# measure=”var”/ c(“var1”,”var2”)   需要将哪些变量组合进id列的变量；若measure缺失，表示所有字段
`new &lt;- melt(economics, id=”data”, measure=c(“unemploy”,”uempmed”)</cite>
<cite>new &lt;- melt(economics, id=”data”, variable.name=”unemploy”,value.name=”uempmed”)</cite></p>
<p># formula中出现的变量，原本为变量的列名，融合后是不参与计算的；参与的是对应的value列</p>
<p>new &lt;- dcast(data, formula, FUN)
# formula，rowvar1+rowvar2 ~ colvar1+colvar2的格式； rowvar-以此为基准的id列；colvar-需要重构的变量列
# FUN，按照任意函数来重构
dcast(data, ID~variable, mean)
<a href="#id21"><span class="problematic" id="id22">``</span></a><a href="#id23"><span class="problematic" id="id24">`</span></a></p>
<p>### 数据行数、唯一值数
<a href="#id25"><span class="problematic" id="id26">``</span></a><a href="#id27"><span class="problematic" id="id28">`</span></a>R
## 返回总行数/列数
ncol() / nrow()</p>
<p>length - 计算元素的长度
## 返回对象的个数 或者 某个列的的观测值行数
length(object/data$col)</p>
<p># 返回对象的唯一值的行数
length(unique(data$col/object))
# 返回非空置的行数
length(na.omit(object/data$col))
<a href="#id29"><span class="problematic" id="id30">``</span></a><a href="#id31"><span class="problematic" id="id32">`</span></a></p>
<p>### tidyr包
1. gather — 宽数据转为长数据。类似于reshape2包中的melt函数
2. spread — 长数据转为宽数据。类似于reshape2包中的cast函数
3. unit — 多列合并为一列
4. separate — 将一列分离为多列
<a href="#id33"><span class="problematic" id="id34">``</span></a><a href="#id35"><span class="problematic" id="id36">`</span></a>R
宽数据转为长数据
gather(data, key, value, …, na.rm = FALSE, convert = FALSE)
# key, value 输出列的名字
# 这里，…表示需要聚合的指定列</p>
<p>mtcarsNew &lt;- mtcars %&gt;% gather(attribute, value, -car)
nrow(mtcarsNew)  # 返回333
# 它把出了car以外的所有列都聚集起来，然后各自地把它们名字都放在各自的属性和相应的值的列中。
<a href="#id37"><span class="problematic" id="id38">``</span></a><a href="#id39"><span class="problematic" id="id40">`</span></a></p>
<p><a href="#id41"><span class="problematic" id="id42">``</span></a><a href="#id43"><span class="problematic" id="id44">`</span></a>R
多列合并为一列
unite()
unite(data, col, …, sep = “_”, remove = TRUE)</p>
<p><a href="#id45"><span class="problematic" id="id46">``</span></a>`
##  数据格式
### 因子化
<a href="#id47"><span class="problematic" id="id48">``</span></a><a href="#id49"><span class="problematic" id="id50">`</span></a>R
## 简单因子化
data$col &lt;- factor(data$col)</p>
<p>## 有序因子化：按当前顺序来指定顺序
data$col &lt;- factor(data$col, order=TRUE, levels=data$col)
## 有序因子化：自定义顺序
data$col &lt;- factor(data$col, order=TRUE, levels=c(“col1”,”col2”))  # 因子顺序，从低到高；左侧为最低</p>
<p>## 简单无序
data$col &lt;- factor(data$col, order=FALSE)
## 无序因子化/名义变量
data$col &lt;- factor(data$col, levels=c(“col1”,”col2”), labels=levels / c(“new_col1”,”new_col2”))
<a href="#id51"><span class="problematic" id="id52">``</span></a>`
* factor与as.factor的区别
* as.factor(x) – 只能对整个数据/列进行转换，其中无法插入其他语法</p>
<p><code class="docutils literal notranslate"><span class="pre">`R</span>
<span class="pre">##</span> <span class="pre">根据第二列的值，重新对第一列的值进行排序</span>
<span class="pre">data$col</span> <span class="pre">&lt;-</span> <span class="pre">reorder(data$col,data$col2,[FUN],[order=T/F])</span>
<span class="pre">#</span> <span class="pre">FUN，表示对第二列进行的变换，以此为排序依据</span>
<span class="pre">#</span> <span class="pre">order=</span> <span class="pre">T/F</span> <span class="pre">,逻辑值，返回一个有序因子</span> <span class="pre">or</span> <span class="pre">一个因素</span>
<span class="pre">`</span></code></p>
<p>### 数据格式索引
格式判断|格式转换|含义
:–:<a href="#id203"><span class="problematic" id="id204">|:--:|</span></a>:–:
is.numeric( )  <a href="#id53"><span class="problematic" id="id54">|</span></a>as.numeric( )|数值格式
is.integer( )  <a href="#id55"><span class="problematic" id="id56">|</span></a>as.integer( )|整数
is.character( )|as.character( ) <a href="#id57"><span class="problematic" id="id58">|</span></a>字符串格式
is.factor( )   <a href="#id59"><span class="problematic" id="id60">|</span></a>as.factor( )    <a href="#id61"><span class="problematic" id="id62">|</span></a>因子化
is.logical( )  <a href="#id63"><span class="problematic" id="id64">|</span></a>as.logical( )   <a href="#id65"><span class="problematic" id="id66">|</span></a>逻辑值</p>
<blockquote>
<div><p>null   | as.Date(object, “format”)     <a href="#id67"><span class="problematic" id="id68">|</span></a>日期格式</p>
</div></blockquote>
<p>is.list( )      <a href="#id69"><span class="problematic" id="id70">|</span></a>as.list( )     <a href="#id71"><span class="problematic" id="id72">|</span></a>列表
is.data.frame( )        <a href="#id73"><span class="problematic" id="id74">|</span></a>as.data.frame  <a href="#id75"><span class="problematic" id="id76">|</span></a>数据框格式
is.matrix( )    <a href="#id77"><span class="problematic" id="id78">|</span></a>as.matrix( )   <a href="#id79"><span class="problematic" id="id80">|</span></a>矩阵格式
is.array( )     <a href="#id81"><span class="problematic" id="id82">|</span></a>as.array( )    <a href="#id83"><span class="problematic" id="id84">|</span></a>数据组
is.vector( )    <a href="#id85"><span class="problematic" id="id86">|</span></a>as.vector( )   <a href="#id87"><span class="problematic" id="id88">|</span></a>向量格式</p>
<ul class="simple">
<li><p>double：数值型格式（双精度向量：保存更多的有效位数）</p></li>
</ul>
<p><a href="#id89"><span class="problematic" id="id90">``</span></a><a href="#id91"><span class="problematic" id="id92">`</span></a>R
data$col &lt;- as.numeric(data$col)</p>
<p>data[,col:col] &lt;- lappy(gb[,col:col], as.numeric)
<code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">###</span> <span class="pre">有效位数&amp;小数位数</span>
<span class="pre">```R</span>
<span class="pre">##</span> <span class="pre">options(digigs=7)</span> <span class="pre">#</span> <span class="pre">默认值</span> <span class="pre">有效位数</span>
<span class="pre">options(digits=n)</span>&#160; <span class="pre">#</span> <span class="pre">限定最小值的有效位数，并使其他数字舍入后与其小数点后的位数相同；</span>
<span class="pre">--xx&lt;-c(98,263.5,</span> <span class="pre">2.43,</span> <span class="pre">1.5531)</span>
<span class="pre">--options(digits=2)</span>&#160;&#160;&#160; <span class="pre">[1]98</span> <span class="pre">263.6</span> <span class="pre">2.4</span> <span class="pre">1.6</span>
<span class="pre">`</span></code></p>
<p># 数据处理
## 绑定数据框
<a href="#id93"><span class="problematic" id="id94">``</span></a><a href="#id95"><span class="problematic" id="id96">`</span></a>R
## with绑定数据框
&lt;- with(data, {</p>
<blockquote>
<div><p>stats &lt;- summary(mpg)</p>
</div></blockquote>
<p>})
# 花括号{}之间的语句都对数据框table执行，赋值仅在此函数的括号内生效；若使用&lt;&lt;则为全局变量
# 若在with符号左侧（new&lt;-with()）出现赋值的对象，则在with符号内产生的赋值依然在其外有效</p>
<p># attach() / detach()  # 必须成对出现
attach(data)
…
detach(…)
<code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">##</span> <span class="pre">基础函数</span>
<span class="pre">```R</span>
<span class="pre">funs(...)</span>
<span class="pre">funs_(dots,</span> <span class="pre">args</span> <span class="pre">=</span> <span class="pre">list(),</span> <span class="pre">env</span> <span class="pre">=</span> <span class="pre">baseenv())</span>
<span class="pre">#</span> <span class="pre">dots,</span> <span class="pre">...</span>
<span class="pre">##</span> <span class="pre">A</span> <span class="pre">list</span> <span class="pre">of</span> <span class="pre">functions</span> <span class="pre">specified</span> <span class="pre">by:</span>
<span class="pre">##</span> <span class="pre">Their</span> <span class="pre">name,</span> <span class="pre">&quot;mean&quot;</span>
<span class="pre">##</span> <span class="pre">The</span> <span class="pre">function</span> <span class="pre">itself,</span> <span class="pre">mean</span>
<span class="pre">##</span> <span class="pre">调用的函数</span> <span class="pre">点号(.)</span> <span class="pre">作为一个虚拟参数</span>&#160; <span class="pre">mean(.,</span> <span class="pre">na.rm</span> <span class="pre">=</span> <span class="pre">TRUE)</span>
<span class="pre">#</span> <span class="pre">args</span>&#160; <span class="pre">指定要添加到所有函数调用的附加参数的列表。(A</span> <span class="pre">named</span> <span class="pre">list</span> <span class="pre">of</span> <span class="pre">additional</span> <span class="pre">arguments</span> <span class="pre">to</span> <span class="pre">be</span> <span class="pre">added</span> <span class="pre">to</span> <span class="pre">all</span> <span class="pre">function</span> <span class="pre">calls.)</span>
<span class="pre">#</span> <span class="pre">env</span>&#160;&#160; <span class="pre">The</span> <span class="pre">environment</span> <span class="pre">in</span> <span class="pre">which</span> <span class="pre">functions</span> <span class="pre">should</span> <span class="pre">be</span> <span class="pre">evaluated.</span>
<span class="pre">-----------------------------------------------------------------------------------</span>
<span class="pre">Examples</span>
<span class="pre">#</span> <span class="pre">funs(mean,</span> <span class="pre">&quot;mean&quot;,</span> <span class="pre">mean(.,</span> <span class="pre">na.rm</span> <span class="pre">=</span> <span class="pre">TRUE))</span>
<span class="pre">#</span> <span class="pre">Overide</span> <span class="pre">default</span> <span class="pre">names</span>
<span class="pre">funs(m1</span> <span class="pre">=</span> <span class="pre">mean,</span> <span class="pre">m2</span> <span class="pre">=</span> <span class="pre">&quot;mean&quot;,</span> <span class="pre">m3</span> <span class="pre">=</span> <span class="pre">mean(.,</span> <span class="pre">na.rm</span> <span class="pre">=</span> <span class="pre">TRUE))</span>
<span class="pre">#</span> <span class="pre">If</span> <span class="pre">you</span> <span class="pre">have</span> <span class="pre">function</span> <span class="pre">names</span> <span class="pre">in</span> <span class="pre">a</span> <span class="pre">vector,</span> <span class="pre">use</span> <span class="pre">funs_</span>
<span class="pre">fs</span> <span class="pre">&lt;-</span> <span class="pre">c(&quot;min&quot;,</span> <span class="pre">&quot;max&quot;)</span>
<span class="pre">funs_(fs)</span>
<span class="pre">`</span></code></p>
<p>## plyr包
* what ：用来切割、计算、合并数据的包
* why ：在一个函数内同时解决spilt-apply-combine的三个步骤</p>
<blockquote>
<div><ul class="simple">
<li><p>Spilt：把要处理的数据分割成小的片段</p></li>
<li><p>Apply：对每个小片段进行操作</p></li>
<li><p>Combine:把片段重新组合</p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><p>how ：</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">`R</span>
<span class="pre">1.</span> <span class="pre">a*ply(.data,</span> <span class="pre">.margins,</span> <span class="pre">.fun,</span> <span class="pre">...,</span> <span class="pre">.progress</span> <span class="pre">=</span> <span class="pre">&quot;none&quot;)</span>
<span class="pre">2.</span> <span class="pre">d*ply(.data,</span> <span class="pre">.variables,</span> <span class="pre">.fun,</span> <span class="pre">...,</span> <span class="pre">.progress</span> <span class="pre">=</span> <span class="pre">&quot;none&quot;)</span>
<span class="pre">3.</span> <span class="pre">l*ply(.data,</span> <span class="pre">.fun,</span> <span class="pre">...,</span> <span class="pre">.progress</span> <span class="pre">=</span> <span class="pre">&quot;none&quot;)</span>
<span class="pre">#</span>
<span class="pre">ddply(.data,</span> <span class="pre">.variables,</span> <span class="pre">.fun</span> <span class="pre">=</span> <span class="pre">NULL,</span> <span class="pre">...,</span> <span class="pre">.progress</span> <span class="pre">=</span> <span class="pre">&quot;none&quot;,</span>&#160; <span class="pre">.inform</span> <span class="pre">=</span> <span class="pre">FALSE,</span> <span class="pre">.drop</span> <span class="pre">=</span> <span class="pre">TRUE,</span> <span class="pre">.parallel</span> <span class="pre">=</span> <span class="pre">FALSE,</span> <span class="pre">.paropts</span> <span class="pre">=</span> <span class="pre">NULL)</span>
<span class="pre">#</span> <span class="pre">第一个参数是要操作的原始数据集，比如baby_name</span>
<span class="pre">#</span> <span class="pre">第二个参数是按照某个（也可以几个）变量，对数据集分割，比如按照year对数据集分割，可以写成.(year)的形式</span>
<span class="pre">#</span> <span class="pre">第三个参数是具体执行操作的函数，对分割后的每一个子数据集，调用该函数</span>
<span class="pre">#</span> <span class="pre">第四个参数可选，表示第三个参数对应函数所需的额外参数</span>
<span class="pre">##</span> <span class="pre">其他参数，可以暂时不用考虑。ddply()函数会自动的将分割后的每一小部分的计算结果汇总，以data.frame的格式保存。&lt;span</span> <span class="pre">style=&quot;color:red&quot;&gt;分割后的数据，是fun的第一个参数。&lt;/span&gt;</span>
<span class="pre">`</span></code></p>
<p><a href="#id97"><span class="problematic" id="id98">``</span></a><a href="#id99"><span class="problematic" id="id100">`</span></a>R
# 对原始数据集做一些操作，并把结果存储在原始数据中
transform()
ddply(baby_names,</p>
<blockquote>
<div><p>.(year, sex),
transform,
rank = rank(-percent, ties.method = “first”)</p>
</div></blockquote>
<p>)
# 第二个参数有点变化，除了year，还有sex，这表示对baby_name数据集，对year和sex分类（类似于SQL中的group by year, sex）。第四个参数是transform的额外参数，如果查看transform的帮助文档，其函数调用方式如下：
# 不追加结果到原始数据，而是产生新的数据集
summarize()
summarize(baby_names_2008_boy, trend = max(percent) - min(percent))
# 0.010266
<a href="#id101"><span class="problematic" id="id102">``</span></a>`
## 数值相关
### 创建
<a href="#id103"><span class="problematic" id="id104">``</span></a><a href="#id105"><span class="problematic" id="id106">`</span></a>R
## 创建序列 - seq()
seq(from_num, to_num, by_num)</p>
<p>## 创建重复值 - rep()
rep(x, n)
<a href="#id107"><span class="problematic" id="id108">``</span></a>`
### 替换与返回
<a href="#id109"><span class="problematic" id="id110">``</span></a><a href="#id111"><span class="problematic" id="id112">`</span></a>R
根据值来替换
## object[object condition] &lt;- XX &lt;- “”  # 前后变量名必须一致
leadership$age[leadership$age&gt;75]&lt;-“Elder”</p>
<p>## ifelse(test, yes, no)
temp6$budget &lt;- with(temp6,{</p>
<blockquote>
<div><p>ifelse(budget&lt;(qnt[1]-h),NA,budget)
ifelse(budget&gt;(qnt[2]+h),NA,budget)})</p>
</div></blockquote>
<p>temp6 &lt;- na.omit(temp6)</p>
<p>## sub()
sub(patter, replacement, object, ignore.case=FALSE, fixed=FALSE)
–# patter表达式/文本字符串， replacement要替换的值，在object中搜索pattern；fixed=F(默认),pattern为正则表达式；fixed=T,pattern为字符串文本 (相似于vlookup函数)
<a href="#id113"><span class="problematic" id="id114">``</span></a><a href="#id115"><span class="problematic" id="id116">`</span></a></p>
<p><code class="docutils literal notranslate"><span class="pre">`R</span>
<span class="pre">根据位置来替换</span>
<span class="pre">##</span> <span class="pre">substr()</span> <span class="pre">-</span> <span class="pre">返回中间的部分；即替换</span>
<span class="pre">substr(object,star_num,stop_num)</span>
<span class="pre">substr(object,star_num,stop_num)</span> <span class="pre">&lt;-</span> <span class="pre">&quot;xx&quot;</span>&#160;&#160; <span class="pre">#用xx替换其之间的值；若数量少于则循环，若大于则不会覆盖超出部分</span>
<span class="pre">`</span></code>
### 拆分
<code class="docutils literal notranslate"><span class="pre">`R</span>
<span class="pre">##</span> <span class="pre">strspilt</span>
<span class="pre">x</span> <span class="pre">&lt;-</span> <span class="pre">strspilt(object,</span> <span class="pre">&quot;sep&quot;,</span> <span class="pre">fixed=FALSE)</span>
<span class="pre">--</span> <span class="pre">#</span> <span class="pre">对object按照”sep&quot;进行分割，若fixed=F(默认),sep为正则表达式；否则为文本字符串；</span>
<span class="pre">strspilt(&quot;abc&quot;,</span> <span class="pre">&quot;&quot;)</span> <span class="pre">--返回含1个成分，3个元素的列表&quot;a&quot;</span> <span class="pre">&quot;b&quot;</span> <span class="pre">&quot;c&quot;</span>
<span class="pre">`</span></code>
### 合并
<a href="#id117"><span class="problematic" id="id118">``</span></a><a href="#id119"><span class="problematic" id="id120">`</span></a>R
## cat合并；将所有的对象合并为一个单元格的值
object &lt;- “name”
x &lt;- cat(“x1”,”x2”,object, num, [sep=””] )</p>
<p>## paste合并；若对象为不同“列”，则一一对应合并；若对象有3列，合并后仍为3列
paste(“x1”,”x2”,4n, …, [sep=””])
<a href="#id121"><span class="problematic" id="id122">``</span></a>`
cat( ) 与 paste( ) 相同与区别</p>
<ul class="simple">
<li><dl class="simple">
<dt>区别：</dt><dd><ul>
<li><p>paste( ) 对应的列单独合并</p></li>
<li><p>cat( ) 合并为一个单元格</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">`R</span>
<span class="pre">&gt;</span> <span class="pre">paste(c(&quot;X&quot;,&quot;Y&quot;),1:10,sep=&quot;&quot;)</span>
<span class="pre">&gt;</span> <span class="pre">#</span> <span class="pre">[1]</span> <span class="pre">&quot;X1&quot;</span>&#160; <span class="pre">&quot;Y2&quot;</span>&#160; <span class="pre">&quot;X3&quot;</span>&#160; <span class="pre">&quot;Y4&quot;</span>&#160; <span class="pre">&quot;X5&quot;</span>&#160; <span class="pre">&quot;Y6&quot;</span>&#160; <span class="pre">&quot;X7&quot;</span>&#160; <span class="pre">&quot;Y8&quot;</span>&#160; <span class="pre">&quot;X9&quot;</span>&#160; <span class="pre">&quot;Y10&quot;</span>
<span class="pre">&gt;</span>
<span class="pre">&gt;</span> <span class="pre">cat(c(&quot;X&quot;,&quot;Y&quot;),1:10,sep=&quot;&quot;)</span>
<span class="pre">&gt;</span> <span class="pre">#</span> <span class="pre">XY12345678910</span>
<span class="pre">&gt;</span>
<span class="pre">`</span></code>
### 长度
<code class="docutils literal notranslate"><span class="pre">`R</span>
<span class="pre">##</span> <span class="pre">计算字符数量</span> <span class="pre">-</span> <span class="pre">nchar</span>
<span class="pre">##</span> <span class="pre">计算元素数量</span> <span class="pre">-</span> <span class="pre">length</span>
<span class="pre">x1&lt;-c(&quot;ab&quot;,&quot;cde&quot;,&quot;fghij&quot;)</span>
<span class="pre">nchar(x1)----2,3,5</span>
<span class="pre">length(x1)----3</span>
<span class="pre">`</span></code>
## 表格相关
### 返回指定子集 - 行
<code class="docutils literal notranslate"><span class="pre">`R</span>
<span class="pre">library(dplyr)</span>
<span class="pre">filter()</span>
<span class="pre">##</span> <span class="pre">根据条件选取</span> <span class="pre">filter(tbl_df,</span> <span class="pre">cond)</span>
<span class="pre">filter(hflights_df,</span> <span class="pre">Month</span> <span class="pre">==</span> <span class="pre">1,</span> <span class="pre">DayofMonth</span> <span class="pre">==</span> <span class="pre">1)</span>
<span class="pre">&lt;-</span> <span class="pre">filter(tbl_df,</span> <span class="pre">x</span> <span class="pre">%in%</span> <span class="pre">c(&quot;a&quot;,&quot;b&quot;))</span>
<span class="pre">#</span> <span class="pre">集合运算：并且(&amp;)，或者(|)</span>
<span class="pre">#</span> <span class="pre">条件判断1：</span> <span class="pre">%in%</span> <span class="pre">-</span> <span class="pre">表示x中含&quot;a&quot;或者&quot;b&quot;的值，返回为逻辑为真</span>
<span class="pre">#</span> <span class="pre">条件判断2：否定(!=)、大于(&gt;)、大于等于(&gt;=)、恒等于(==)</span>
<span class="pre">##</span> <span class="pre">排除多条件的观测值</span> <span class="pre">/</span> <span class="pre">或者用</span> <span class="pre">&amp;</span> <span class="pre">联接</span>
<span class="pre">&lt;-</span> <span class="pre">filter(iris,!Species</span> <span class="pre">%in%</span> <span class="pre">c(&quot;setosa&quot;))</span>
<span class="pre">&lt;-</span> <span class="pre">filter(iris,Species</span> <span class="pre">!=&quot;setosa&quot;</span> <span class="pre">&amp;</span> <span class="pre">Species</span> <span class="pre">!=</span> <span class="pre">&quot;kaggle&quot;)</span>
<span class="pre">##</span> <span class="pre">选中子集中的特定列</span>
<span class="pre">filter()</span> <span class="pre">%&gt;%</span> <span class="pre">select(.,</span> <span class="pre">var)</span>
<span class="pre">##</span> <span class="pre">通过行数的位置进行选取</span>
<span class="pre">filter(tbl_df,</span> <span class="pre">n:n)</span>&#160; <span class="pre">#</span> <span class="pre">等价于data[n:n,</span> <span class="pre">]</span>
<span class="pre">--------------------------------------------------------------------------------------</span>
<span class="pre">##</span> <span class="pre">前/后/任意选取</span>
<span class="pre">head(data,</span> <span class="pre">n)</span> <span class="pre">等价于</span> <span class="pre">first(data,</span> <span class="pre">n)</span>
<span class="pre">tail(data,</span> <span class="pre">n)</span> <span class="pre">等价于</span> <span class="pre">last(data,</span> <span class="pre">n)</span>
<span class="pre">nth(x)</span> <span class="pre">#</span> <span class="pre">返回第x个观测</span>&#160; <span class="pre">(dplyr包)</span>
<span class="pre">##</span> <span class="pre">随机选取</span>
<span class="pre">sample_frac(iris,</span> <span class="pre">0.5,</span> <span class="pre">replace=TRUE)</span>&#160; <span class="pre">#</span> <span class="pre">按比例</span>
<span class="pre">sample_n(iris,</span> <span class="pre">10,</span> <span class="pre">replace=TRUE)</span>&#160; <span class="pre">#</span> <span class="pre">按数量</span>
<span class="pre">##</span> <span class="pre">选取并排列前n个数</span>
<span class="pre">top_n(tbl_df,</span> <span class="pre">n)</span>
<span class="pre">top_n(tbl_df,-n)</span>&#160; <span class="pre">#</span> <span class="pre">从底部开始选择n个数据</span>
<span class="pre">##</span> <span class="pre">删除重复值</span>
<span class="pre">distinct(hflights_df,</span> <span class="pre">Month,</span> <span class="pre">.keep_all</span> <span class="pre">=</span> <span class="pre">TRUE)</span>
<span class="pre">#.keep_all</span> <span class="pre">=</span> <span class="pre">TRUE指保留除Month以外的其它列的内容。默认的情况是不保存其他列的。</span>
<span class="pre">`</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">`R</span>
<span class="pre">##</span> <span class="pre">subset选取</span>
<span class="pre">subset(data,</span> <span class="pre">condition,</span> <span class="pre">select=c(col1,col2)</span> <span class="pre">/</span> <span class="pre">col1:col2</span> <span class="pre">)</span>
<span class="pre">`</span></code></p>
<p>## 返回指定子集 - 列
<a href="#id123"><span class="problematic" id="id124">``</span></a><a href="#id125"><span class="problematic" id="id126">`</span></a>R
library(dplyr)
select()
## 通过列名(无需引号)来选取
select(tbl_df, var1,var2)
#连续多变量 select(tbl_df, var1:var4)
#排除某变量 select(tbl_df, -var)  / select(tbl_df, -(var1:var4))
select(hflights_df, -(Year:DayOfWeek))
## 不同条件列选择 - select_if()
hflights %&gt;% select_if(is.factor)
hflights %&gt;% select_if(function(col) is.numeric(col) &amp;&amp; mean(col) &gt; 3.5)
——————————————————————————————-
## 通过选项函数进行选择
#列名中以元素x为首的列 - starts_with(“x”)
select(iris_df, starts_with(“Petal”))</p>
<p>#列名中以元素x结尾的列 -  ends_with(“x”)
select(iris, ends_with(“Width”))</p>
<p>#列名中包含元素x的列 - contains(“x”)
select(iris_df, contains(“etal”))
#排除对应的列，函数前加负号 -
select(iris_df, - starts_with(“Petal”))</p>
<p>#所有变量 - everything() 一般调整数据集中变量顺序时使用
select(df2tbl,y,everything())  #将变量y放到最前</p>
<p>#选择包含在声明变量中的 - one_of(“”)
select(iris_df, one_of(“Species”,”Petal.Width”))  # 等价于 select(tbl_df, var,var)</p>
<p>#选择名称符合指定匹配正则表达式的列 - matches(“”)
select(iris, matches(“.t.”))</p>
<p>#选择x01到x05的变量
num_range(‘x’, 1:5, width = 2)
<code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">```R</span>
<span class="pre">1.</span> <span class="pre">vector-向量</span>
<span class="pre">x</span> <span class="pre">&lt;-</span> <span class="pre">x[num:num]</span> <span class="pre">/</span> <span class="pre">&lt;-</span> <span class="pre">x[c(num1,num2,num3)]</span>
<span class="pre">2.矩阵/数组/数据框--[]方括号中无逗号出现，表示选取列</span>
<span class="pre">(1)z</span> <span class="pre">&lt;-</span> <span class="pre">z[i,j]</span> <span class="pre">/</span> <span class="pre">z[i,</span> <span class="pre">]</span> <span class="pre">/</span> <span class="pre">z[,</span> <span class="pre">j]</span> <span class="pre">/</span> <span class="pre">z[i:j,</span> <span class="pre">]</span> <span class="pre">/</span> <span class="pre">z[</span> <span class="pre">,i:j]</span> <span class="pre">/</span> <span class="pre">z[i:j]</span>
<span class="pre">(2)z</span> <span class="pre">&lt;-</span> <span class="pre">z[c(&quot;row&quot;,&quot;row&quot;)</span> <span class="pre">,</span> <span class="pre">]</span> <span class="pre">有逗号/</span> <span class="pre">z[,</span> <span class="pre">c(&quot;col&quot;,&quot;col&quot;)]</span> <span class="pre">/</span> <span class="pre">[c(&quot;col&quot;,</span> <span class="pre">&quot;col&quot;)]</span>
<span class="pre">3.列表</span>
<span class="pre">x</span> <span class="pre">&lt;-</span> <span class="pre">mylist[[</span> <span class="pre">]]</span> <span class="pre">--其中规则与2中相同</span>
<span class="pre">`</span></code>
### 更改数据/创建新变量
<a href="#id127"><span class="problematic" id="id128">``</span></a><cite>R
## 在原始数据上做修改
library(dplyr)
transfrom()
transform(df, var3=var1+var2)  # 此时将创建新列； 若为 var2 = var2 * 1.5 则将替换为2倍的var2的值
transform(gb, round(select(gb, 消费金额,激活净值,总收入_含点差),2))  # 因为在源数据上做修改，所以无需赋值
## 创建新列
data$new_col &lt;- c( , )
—————————————————-
mutate(tbl_df, var3=var1+var2, var4=var3+..)
# 优势在于可对刚添加的列进行变换
`mutate(hflights_df,  gain = ArrDelay - DepDelay, gain_per_hour = gain / (AirTime / 60)）</cite></p>
<p>## 对每一列运行窗口函数 - mutate_each()
mutate_each(iris, funs(min_rank), [var1,var2])
# 窗口函数
–between()  # 数据在a、b之间
–lag  # 把除最后一位以外的所有数据延后，第一个元素为NA
–ntile  # 把数据分为n分
–lead  # 把除第一个值以外的所有元素提前，最后一位为NA
–percent_rank  # 把数据在[0,1]中重组，并排序
–row_number # 排序。并列时将并列数在前的序号在前
–dense_rank  #无缝排序
–min_rank  # 排序，并列时，其他序号延号
<code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">###</span> <span class="pre">概述函数</span>
<span class="pre">```R</span>
<span class="pre">#</span> <span class="pre">创建新的对象</span>
<span class="pre">library(dplry)</span>
<span class="pre">summarize()</span>
<span class="pre">##</span> <span class="pre">对数据进行概述，并创建新的子集</span>
<span class="pre">summarize(tbl_df,FUN,na.rm=T)</span> <span class="pre">#</span> <span class="pre">常伴有na.rm=T</span>
<span class="pre">`summarize(hflights_df,</span>&#160; <span class="pre">delay</span> <span class="pre">=</span> <span class="pre">mean(DepDelay,</span> <span class="pre">na.rm</span> <span class="pre">=</span> <span class="pre">TRUE))`</span>
<span class="pre">#</span> <span class="pre">概述函数</span>
<span class="pre">--first()</span> <span class="pre">/</span> <span class="pre">last()</span> <span class="pre">/</span> <span class="pre">nth()</span>
<span class="pre">--n()</span> <span class="pre">/</span> <span class="pre">n_distinct()</span>
<span class="pre">--min()</span> <span class="pre">/</span> <span class="pre">max()</span> <span class="pre">/</span> <span class="pre">mean()</span> <span class="pre">/</span> <span class="pre">sd()</span> <span class="pre">/</span> <span class="pre">median()</span> <span class="pre">/</span> <span class="pre">IQR()</span> <span class="pre">/</span> <span class="pre">sum()</span>
<span class="pre">##</span> <span class="pre">分组后求数据聚合</span>
<span class="pre">summarize(group_by(df2tbl,x),</span> <span class="pre">sum(y))</span>
<span class="pre">group_by(tbl_df,var)</span> <span class="pre">%&gt;%</span> <span class="pre">summarize(.,</span> <span class="pre">sum(Y))</span>
<span class="pre">##</span> <span class="pre">对每一列运行概述函数</span>
<span class="pre">summarise_each_(tbl,</span> <span class="pre">funs(mean(.,</span> <span class="pre">na.rm=T)),</span> <span class="pre">vars)</span>
<span class="pre">#</span> <span class="pre">vars,</span> <span class="pre">与Select用法相同。如果确实，则选择所有未分组的变量.</span>
<span class="pre">#</span> <span class="pre">funs(sum(.,</span> <span class="pre">na.rm=T))</span>
<span class="pre">--------------------------------------------------------------------------------------</span>
<span class="pre">count()</span>
<span class="pre">##</span> <span class="pre">计算变量中每一个特定值的行数</span>
<span class="pre">count(tbl_df,</span> <span class="pre">var,</span> <span class="pre">[wt=])</span>
<span class="pre">#</span> <span class="pre">wt=&quot;&quot;</span>&#160; <span class="pre">若缺失，则统计数量；分类统计观测值行数</span>
<span class="pre">count(iris,</span> <span class="pre">Species)</span>&#160; <span class="pre">#</span> <span class="pre">分组计算Species列中各类别的频量；类似于基本函数包中的table函数</span>
<span class="pre">#</span> <span class="pre">wt=&quot;&quot;,若指定某一列，则会通过计算非缺失值的总和来比对权重(weighted)；</span>
<span class="pre">#</span> <span class="pre">wt</span> <span class="pre">=</span> <span class="pre">var2</span> <span class="pre">，</span> <span class="pre">表示按var中的类别来分组计算var2中未缺失值的对应的求和</span>
<span class="pre">count(iris,</span> <span class="pre">Species,</span> <span class="pre">wt=Sepal.Length)</span>&#160; <span class="pre">#</span> <span class="pre">即按Species分组后，求对应Sepal.Length中的值的总和</span>
<span class="pre">--等价于</span>&#160; <span class="pre">iris</span> <span class="pre">%&gt;%</span> <span class="pre">group_by(.,</span> <span class="pre">Species)</span> <span class="pre">%&gt;%</span> <span class="pre">summarize(.,</span> <span class="pre">sum(Sepal.Length))</span>
<span class="pre">`</span></code></p>
<p>### 分组与排序
<code class="docutils literal notranslate"><span class="pre">`R</span>
<span class="pre">library(dplyr)</span>
<span class="pre">gropu_by</span>
<span class="pre">##</span> <span class="pre">分组</span>
<span class="pre">groub_by(tbl_df,</span> <span class="pre">var)</span>&#160; <span class="pre">#</span> <span class="pre">var为分组变量</span>
<span class="pre">iris</span> <span class="pre">%&gt;%</span> <span class="pre">group_by(.,</span> <span class="pre">Species)</span> <span class="pre">%&gt;%</span> <span class="pre">summarize(.,</span> <span class="pre">sum(Sepal.Length))</span>
<span class="pre">#</span> <span class="pre">为每一个分组分别进行概述</span>
<span class="pre">iris</span> <span class="pre">%&gt;%</span> <span class="pre">group_by(.,</span> <span class="pre">Species)</span> <span class="pre">%&gt;%</span> <span class="pre">mutate(.,</span> <span class="pre">...))</span>
<span class="pre">#</span> <span class="pre">按组计算新变量</span>
<span class="pre">ungroup(iris)</span>
<span class="pre">##</span> <span class="pre">移出数据框的分组信息</span>
<span class="pre">`</span></code>
<a href="#id129"><span class="problematic" id="id130">``</span></a><a href="#id131"><span class="problematic" id="id132">`</span></a>R
library(dplyr)
排序 - arrange()
arrange(tbl_df,var,desc(var))
# 默认为升序排序；降序为desc
arrange(flights, desc(dep_delay - arr_delay))
# 可以在排序里面使用计算
————————————————————————————–
## 排序 reorder
# 以对col2列进行函数FUN处理后为排序标准，对col1进行排序；默认为升序，且默认转为有序因子order=T
reorder(data$col1, data$col2,FUN,[order=T])
with(InsectSprays, reorder(spray, count, median)  # 以count列的中位数为排序标准对spray进行升序排列</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">###</span> <span class="pre">管道函数</span>
<span class="pre">```R</span>
<span class="pre">%&gt;%</span>
<span class="pre">#</span> <span class="pre">将对象传递给下一个函数的第一个参数</span>
<span class="pre">`</span></code>
### 数据合并
<code class="docutils literal notranslate"><span class="pre">`R</span>
<span class="pre">bind_rows(y,z)</span>&#160; <span class="pre">#</span> <span class="pre">将数据集z作为新的行插入到y中</span>
<span class="pre">bind_cols(y,z)</span>&#160; <span class="pre">#</span> <span class="pre">将数据集z作为新的列插入到y中</span>
<span class="pre">##</span> <span class="pre">但必须调整好顺序</span>
<span class="pre">left_join(a,b,by=&quot;x1&quot;)</span>&#160; <span class="pre">#</span> <span class="pre">向数据集a中加入匹配的数据集b记录</span>
<span class="pre">inner_join(a,b,by=&quot;x1&quot;)</span>
<span class="pre">outer_join(a,b,</span> <span class="pre">by=&quot;x1&quot;)</span>&#160; <span class="pre">#</span> <span class="pre">保留所记录，所有行</span>
<span class="pre">---------------------------------------------------------------------------------</span>
<span class="pre">##</span> <span class="pre">合并列</span>
<span class="pre">cbind(object1,</span> <span class="pre">object2)</span>&#160; <span class="pre">#</span> <span class="pre">object1在前；但每个对象必须有相同的行数，且有相同的顺序；</span>
<span class="pre">cbind(object1,object[,-1])</span> <span class="pre">/</span> <span class="pre">cbind(object1,</span> <span class="pre">data$col)</span>
<span class="pre">#1.当合并的对象中有要丢弃的向量时，可一步完成；</span>
<span class="pre">#2.若不是对于丢弃的向量，data[,j]表示的是跟data的第j列合并</span>
<span class="pre">---------------------------------------------------------------------------------</span>
<span class="pre">##</span> <span class="pre">合并行</span>
<span class="pre">rbind(object1,</span> <span class="pre">object2)</span>
<span class="pre">##</span> <span class="pre">merge合并</span>
<span class="pre">merge(object1,</span> <span class="pre">object2,</span> <span class="pre">by=&quot;col_name&quot;/=c(&quot;x1&quot;,&quot;x2&quot;))</span>&#160; <span class="pre">#</span> <span class="pre">按照by的内容来合并列</span>
<span class="pre">`</span></code>
### 数据拆分
<code class="docutils literal notranslate"><span class="pre">`R</span>
<span class="pre">对整个表格数据作用</span>
<span class="pre">##</span> <span class="pre">将连续型变量x分给为n个区间；用于创建美观的分割点</span>
<span class="pre">pretty(x,</span> <span class="pre">n)</span>
<span class="pre">##</span> <span class="pre">将连续型变量x分割成有n个水平的因子</span>
<span class="pre">cut(x,</span> <span class="pre">n,[order_result=TRUE])</span>
<span class="pre">`</span></code>
### 数据划分
<code class="docutils literal notranslate"><span class="pre">`R</span>
<span class="pre">##</span> <span class="pre">划分训练集、测试集</span>
<span class="pre">library(caret)</span>
<span class="pre">set.seed(1234)</span>&#160; <span class="pre">#</span> <span class="pre">必须要有，因为划分是随机划分的；</span>
<span class="pre">createDataPartition(y,</span> <span class="pre">p=0.x</span> <span class="pre">,</span> <span class="pre">time=1,</span> <span class="pre">list=TRUE)</span>
<span class="pre">#</span> <span class="pre">time=num,</span> <span class="pre">(默认为1），要创建的分区的数目</span>
<span class="pre">#</span> <span class="pre">p=0.x</span> <span class="pre">,</span> <span class="pre">划分为p%的训练数据的百分比，故(1-p)为检验样本量的百分比</span>
<span class="pre">#</span> <span class="pre">list=FALSE/TRUE，逻辑值；</span> <span class="pre">一般为FALSE</span>
<span class="pre">#</span> <span class="pre">y,</span> <span class="pre">target</span> <span class="pre">variable，目标变量</span>
<span class="pre">inTraining</span> <span class="pre">&lt;-</span> <span class="pre">createDataPartition(hr_model$left,</span> <span class="pre">p</span> <span class="pre">=</span> <span class="pre">.75,</span> <span class="pre">list</span> <span class="pre">=</span> <span class="pre">FALSE)</span>&#160; <span class="pre">#</span> <span class="pre">将数据进行划分成75%的训练样本和25%检验样本</span>
<span class="pre">training</span> <span class="pre">&lt;-</span> <span class="pre">hr_model[</span> <span class="pre">inTraining,]</span> <span class="pre">-将75%的训练样本数据添加到hr_model</span>
<span class="pre">testing</span>&#160; <span class="pre">&lt;-</span> <span class="pre">hr_model[-inTraining,]</span> <span class="pre">-将余下25%的检验样本数据添加到hr_model</span>
<span class="pre">print(table(hr_model$left))</span> <span class="pre">-</span> <span class="pre">输出分割后的数据行数</span>
<span class="pre">`</span></code>
## 日期处理
<code class="docutils literal notranslate"><span class="pre">`R</span>
<span class="pre">##</span> <span class="pre">当前日期</span>
<span class="pre">Sys.Date()</span> <span class="pre">/</span> <span class="pre">date()</span>
<span class="pre">##</span> <span class="pre">日期间隔</span> <span class="pre">-</span> <span class="pre">difftme</span>
<span class="pre">difftime(object1,</span> <span class="pre">object2,</span> <span class="pre">units=&quot;&quot;)</span>
<span class="pre">--&quot;auto”,&quot;secs”,&quot;mins”,&quot;hours”,&quot;days”,&quot;weeks”其中的一个，默认为天</span>
<span class="pre">##</span> <span class="pre">日期格式</span>
<span class="pre">as.Data(object,</span> <span class="pre">&quot;input_format&quot;)</span>
<span class="pre">as.Date(x,</span> <span class="pre">&quot;01/02/1956&quot;)</span>
<span class="pre">##</span> <span class="pre">输出指定格式的日期值，并可以提取日期中的某些部分</span>
<span class="pre">format(x,</span> <span class="pre">format=&quot;output_foramt&quot;)</span>
<span class="pre">format(today,</span> <span class="pre">format=&quot;%B</span> <span class="pre">%d</span> <span class="pre">%Y&quot;)</span>
<span class="pre">#</span> <span class="pre">[1]</span> <span class="pre">&quot;November</span> <span class="pre">27</span> <span class="pre">2014&quot;</span>
<span class="pre">format(today,</span> <span class="pre">format=&quot;%A&quot;)</span>
<span class="pre">#</span> <span class="pre">[1]</span> <span class="pre">&quot;Thursday&quot;</span>
<span class="pre">`</span></code></p>
<p>## 数字处理
<code class="docutils literal notranslate"><span class="pre">`R</span>
<span class="pre">options(digigs=7)</span> <span class="pre">#</span> <span class="pre">默认值</span>
<span class="pre">##</span> <span class="pre">指定小数位数（舍入）</span> <span class="pre">-</span> <span class="pre">round</span>
<span class="pre">round(x,</span> <span class="pre">[digits=num])</span>&#160; <span class="pre">#</span> <span class="pre">将x舍入为指定位数n的小数（默认值为0）</span>
<span class="pre">##</span> <span class="pre">指定有效位数（舍入）</span> <span class="pre">-</span> <span class="pre">sigif()</span>
<span class="pre">sigif(x,</span> <span class="pre">[digits=num])</span>&#160; <span class="pre">#</span> <span class="pre">指定最小值的有效位数</span>
<span class="pre">--sigif(3.531,digits=2)</span>&#160; <span class="pre">#</span> <span class="pre">返回</span> <span class="pre">3.5</span>
<span class="pre">##</span> <span class="pre">取整</span> <span class="pre">-</span> <span class="pre">trunc()</span>
<span class="pre">trunc(3.531)</span>&#160; <span class="pre">#</span> <span class="pre">返回3</span>
<span class="pre">##</span> <span class="pre">取整</span> <span class="pre">-</span> <span class="pre">向上/向下</span>
<span class="pre">floor()</span>&#160; <span class="pre">#</span> <span class="pre">向下取整；等同于Int</span>
<span class="pre">ceiling()</span>&#160; <span class="pre">#</span> <span class="pre">向上取整(大于等于x最小整数)</span>
<span class="pre">-------------------------------------</span>
<span class="pre">abs(x)</span>&#160; <span class="pre">#</span> <span class="pre">绝对值</span>
<span class="pre">x</span> <span class="pre">%%</span> <span class="pre">y</span>&#160; <span class="pre">#</span> <span class="pre">余数</span>
<span class="pre">exp(x)</span>&#160; <span class="pre">#</span> <span class="pre">指数</span>
<span class="pre">ln(x)</span> <span class="pre">/</span> <span class="pre">log(x,[y])</span>&#160; <span class="pre">#</span> <span class="pre">对数</span>
<span class="pre">sqrt(x)</span>&#160; <span class="pre">#</span> <span class="pre">平方根</span>
<span class="pre">x^n</span>&#160; <span class="pre">#</span> <span class="pre">幂次方</span>
<span class="pre">`</span></code>
<code class="docutils literal notranslate"><span class="pre">`R</span>
<span class="pre">##</span> <span class="pre">列/行求和</span>
<span class="pre">colSums(x)</span>
<span class="pre">rowSums(x)</span>
<span class="pre">##</span> <span class="pre">行/列均值</span>
<span class="pre">colMeans(x)</span>
<span class="pre">rowMeans(x)</span>
<span class="pre">range(object)</span>&#160; <span class="pre">#</span> <span class="pre">值域</span>
<span class="pre">quantile(x,c(0.n,0.n))</span>&#160; <span class="pre">#</span> <span class="pre">分位数</span>
<span class="pre">sd(x)</span>&#160; <span class="pre">#</span> <span class="pre">标准差</span>
<span class="pre">var(x)</span>&#160; <span class="pre">#</span> <span class="pre">方差</span>
<span class="pre">`</span></code>
## 缺失值与唯一值
<code class="docutils literal notranslate"><span class="pre">`R</span>
<span class="pre">缺失值与不可能值</span>
<span class="pre">##</span> <span class="pre">检查缺失值</span>
<span class="pre">is.na(x)</span>&#160; <span class="pre">#</span> <span class="pre">缺失值</span>
<span class="pre">colSums(is.na(x))</span>&#160; <span class="pre">#</span> <span class="pre">求该列缺失值的数量</span>
<span class="pre">mean(is.na(x))</span>&#160; <span class="pre">#</span> <span class="pre">若比例小，可直接移除</span> <span class="pre">na.omit(x)</span>
<span class="pre">is.nan(x)</span>&#160; <span class="pre">#</span> <span class="pre">不可能值</span>
<span class="pre">is.infinite(x)</span>&#160; <span class="pre">#</span> <span class="pre">无穷值</span>
<span class="pre">---------------------------------------------</span>
<span class="pre">##</span> <span class="pre">移除缺失值</span>
<span class="pre">na.rm</span> <span class="pre">=</span> <span class="pre">T</span>&#160; <span class="pre">#</span> <span class="pre">在计算之前将缺失值移除，可用在函数内部</span>
<span class="pre">##</span> <span class="pre">整行删除</span>
<span class="pre">na.omit(x)</span>&#160; <span class="pre">#</span> <span class="pre">移除所有含缺失值所在的行【删除整行】</span>
<span class="pre">newdata</span> <span class="pre">&lt;-</span> <span class="pre">na.omit(mydata)</span>&#160; <span class="pre">#</span> <span class="pre">用来存储没有缺失值的数据</span>
<span class="pre">`</span></code>
<a href="#id133"><span class="problematic" id="id134">``</span></a><a href="#id135"><span class="problematic" id="id136">`</span></a>R
唯一值
## 只对向量可用；或对 各行中各变量完全相同的行取一行
unique(x)
## 可对数据框使用
!duplicated(x)  # 返回逻辑值；若完全相同则为TRUE
逻辑：返回data中所有不相同的值，然后在进行行选取data[x, ]
# 删除各行中变量完全相同的值 = unique(x)
data &lt;- data[!duplicated(data), ]    –# 返回各列所有相同的值 data[duplicated(test),]
# 删除某变量中相同的值
data &lt;- data[!duplicated(test[, “var”]), ]
– # 返回单列所有相同的值  data[duplicate(test[,var]),]
# 删除某两个变量完全相同的行</p>
<blockquote>
<div><p>data &lt;- data[!duplicated(test[, c(“var1”,”var2”)], ]</p>
</div></blockquote>
<p>– # 返回多列相同的值 data[dulpicated(test[,c(“var1”,”var2”)],]
<code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">##</span> <span class="pre">逻辑判断</span>
<span class="pre">```R</span>
<span class="pre">which()</span>&#160; <span class="pre">#</span> <span class="pre">返回为真的逻辑对象，允许对数组array使用</span>
<span class="pre">`</span></code>
## R符号
### 常见符号
名称|作用
–<a href="#id137"><span class="problematic" id="id138">|</span></a>–
&lt;-      <a href="#id139"><span class="problematic" id="id140">|</span></a>赋值符号
/       <a href="#id141"><span class="problematic" id="id142">|</span></a>转义符
[ ]     <a href="#id143"><span class="problematic" id="id144">|</span></a>给定元素所处位置的数值    a[c(2,4)]
：       <a href="#id145"><span class="problematic" id="id146">|</span></a>用于表示一个数值序列     a[2:6]
[i,j]   <a href="#id147"><span class="problematic" id="id148">|</span></a>选择指定的行与列       [i,] [,j] [i,j] [,]
“”      <a href="#id149"><span class="problematic" id="id150">|</span></a>用于目录名、文件名、包
‘ ‘     <a href="#id151"><span class="problematic" id="id152">|</span></a>引用双引号的文字为文本时出现 labs(title=’ positon=”fill” ‘)
#       <a href="#id153"><span class="problematic" id="id154">|</span></a>用于注释。#之后出现的任何文本都会被R解释器忽视； 并且R只能对单行进行注释，故当出现多条命令符，需在每行前面加上#
$       <a href="#id155"><span class="problematic" id="id156">|</span></a>选取一个给定数据框中的某个特定变量      patientIDdata$age
&lt;&lt;-     <a href="#id157"><span class="problematic" id="id158">|</span></a>特殊赋值符
[[ ]]   <a href="#id159"><span class="problematic" id="id160">|</span></a>用于列表中选取对象      mylist[[“ages”]] mylist[[2]]
^或**    <a href="#id161"><span class="problematic" id="id162">|</span></a>求幂
x% %y   <a href="#id163"><span class="problematic" id="id164">|</span></a>求余数（x mod y) 5%%2=1
x% / %y <a href="#id165"><span class="problematic" id="id166">|</span></a>整数除法。5%/2%=2
==      <a href="#id167"><span class="problematic" id="id168">|</span></a>严格等于（在浮点型数值时慎用==）      2+2==4
!=      <a href="#id169"><span class="problematic" id="id170">|</span></a>不等于
!x      <a href="#id171"><span class="problematic" id="id172">|</span></a>非x
x∣y     <a href="#id173"><span class="problematic" id="id174">|</span></a>x或y
x&amp;y     <a href="#id175"><span class="problematic" id="id176">|</span></a>x和y
isTRUE(x)       <a href="#id177"><span class="problematic" id="id178">|</span></a>测试x是否为TRUE
[,-1] [-1,] [,c(-2,-3)]/[,-c(2,3)]      <a href="#id179"><span class="problematic" id="id180">|</span></a>删除第一列 删除第一行 删除多列，两种表达方式均可      mydata&lt;-mydata[,-1] mydata&lt;-mydata[,-c(2,3)]
“[“     <a href="#id181"><span class="problematic" id="id182">|</span></a>提取谋而对象一部分的函数，后跟序列数n；1表示该对象的第一部分； 2表示该对象的第二部分；</p>
<p>### R中常见表达式
符号|     作用      |       解释
–<a href="#id205"><span class="problematic" id="id206">|--|</span></a>–
～       <a href="#id207"><span class="problematic" id="id208">|分隔符号   |y～x+z+w        左边-因变量/响应变量 右边-自变量/解释变量
+       |分隔预测变量
：       |预测变量的交互项|</span></a>      y～x+z+x:z
*       <a href="#id209"><span class="problematic" id="id210">|所有可能交互项的表达方式   |y～xzw—y～x+z+w+x:z+x:w+z:w
^       |交互项的某个次数|</span></a>      y～(x+z+w)^2—y～x+z+w+x:z+x:w+z:w 交互项最高次为2次
.       <a href="#id211"><span class="problematic" id="id212">|包含除因变量之外的所有变量|</span></a> y～.—y～x+z+w     当一个数据框包含y,x,z,w这四个变量时
-       <a href="#id213"><span class="problematic" id="id214">|减号，从等式中移除某个变量|</span></a> y～(x+z+w)^2-x:w— y～x+z+w+x:z+z:w
-1      <a href="#id183"><span class="problematic" id="id184">|</span></a>删除截距项  <a href="#id185"><span class="problematic" id="id186">|</span></a>y～x-1  拟合y在x上的回归，并强制直线通过原点
I() <a href="#id187"><span class="problematic" id="id188">|</span></a>【大写的i】     从算术（而非表示式）的角度来解释括号中的元素  <a href="#id189"><span class="problematic" id="id190">|</span></a>y～x+I((z+w)^2) 表示的是x+(z+w)²，而非x+z+w+z:w
function        <a href="#id191"><span class="problematic" id="id192">|</span></a>可以在表达式中运用的数学函数 <a href="#id193"><span class="problematic" id="id194">|</span></a>log(y)～x+z+w
mpg ~ wt      <a href="#id195"><span class="problematic" id="id196">|</span></a>cyl    <a href="#id197"><span class="problematic" id="id198">|</span></a>表示按条件（cyl）绘图</p>
<p>### 研究设计表达式
表达式     <a href="#id215"><span class="problematic" id="id216">|作用     |解释
--|</span></a>–<a href="#id217"><span class="problematic" id="id218">|--
y～A     |单因素ANOVA       |1.小写字母，定量变量 2.大写字母，组别因子（若不转换为factor，则默认为定量协变量） 3.Subject，被试者独有的标志变量 4.Error(Subject/A)，表示组内因子
y～x+A   |含单个协变量的单因素ANCOVA|</span></a>
y～A * B <a href="#id219"><span class="problematic" id="id220">|双因素ANOVA       |展开为 ~A+B+A:B
y～x1+x2+A*B     |含两个协变量的双因素ANCOVA|</span></a>
y～B+A（B是区组因子）   <a href="#id221"><span class="problematic" id="id222">|随机化区组|</span></a>
y～A + Error(Subject/A)  <a href="#id223"><span class="problematic" id="id224">|单因素组内ANOVA|</span></a>
y～B*W+Error(Subject/W)  <a href="#id199"><span class="problematic" id="id200">|</span></a>含单个组内因子(W)和单个组间因子(B)的重复测量ANOVA <a href="#id201"><span class="problematic" id="id202">|</span></a>展开为 ~B+W+B:W</p>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../Snippet/R.html" class="btn btn-neutral float-right" title="R" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../53_R.html" class="btn btn-neutral" title="R" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, AdamZhou.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> and ❤️  using a custom <a href="https://github.com/LinxiFan/Stanford-theme">theme</a> based on <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'2.0.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/documentation_options.js"></script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>